<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ETFè½®åŠ¨ç­–ç•¥ç ”ç©¶</title>
  <style>
    :root {
      --primary-color: #1a5f7a;
      --secondary-color: #159895;
      --accent-color: #57c5b6;
      --bg-color: #f8f9fa;
      --card-bg: #ffffff;
      --text-color: #333333;
      --text-light: #666666;
      --border-color: #e0e0e0;
      --success-color: #28a745;
      --warning-color: #ffc107;
      --danger-color: #dc3545;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      margin: 0;
      padding: 0;
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    header h1 {
      margin: 0 0 10px 0;
      font-size: 28px;
    }

    header p {
      margin: 0;
      opacity: 0.9;
    }

    .nav-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid var(--border-color);
      padding-bottom: 0;
    }

    .nav-tab {
      padding: 12px 24px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      color: var(--text-light);
      transition: all 0.3s;
    }

    .nav-tab:hover {
      color: var(--primary-color);
    }

    .nav-tab.active {
      color: var(--primary-color);
      border-bottom-color: var(--primary-color);
    }

    .card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 16px 0;
      color: var(--primary-color);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }

    .stat-card.success {
      background: linear-gradient(135deg, var(--success-color), #20c997);
    }

    .stat-card.warning {
      background: linear-gradient(135deg, var(--warning-color), #fd7e14);
    }

    .stat-card.danger {
      background: linear-gradient(135deg, var(--danger-color), #e83e8c);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    th {
      background-color: var(--bg-color);
      font-weight: 600;
      color: var(--text-light);
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    tr:hover {
      background-color: #f8f9fa;
    }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }

    .badge-success {
      background-color: #d4edda;
      color: #155724;
    }

    .badge-warning {
      background-color: #fff3cd;
      color: #856404;
    }

    .badge-danger {
      background-color: #f8d7da;
      color: #721c24;
    }

    .progress-bar {
      height: 8px;
      background-color: var(--border-color);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 5px;
    }

    .progress-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.3s;
    }

    .code-block {
      background-color: #2d2d2d;
      color: #f8f8f2;
      padding: 16px;
      border-radius: 8px;
      font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
      font-size: 13px;
      overflow-x: auto;
    }

    .etf-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
    }

    .etf-item {
      background: var(--bg-color);
      padding: 12px 16px;
      border-radius: 8px;
      border-left: 4px solid var(--secondary-color);
    }

    .etf-code {
      font-weight: 600;
      color: var(--primary-color);
    }

    .etf-name {
      font-size: 13px;
      color: var(--text-light);
      margin-top: 4px;
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    .chart-container {
      height: 400px;
      background: var(--bg-color);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-light);
    }

    .filter-row {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .filter-group label {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-light);
    }

    select, input {
      padding: 8px 12px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 14px;
      min-width: 150px;
    }

    button {
      padding: 10px 20px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: var(--secondary-color);
    }

    button.secondary {
      background-color: var(--bg-color);
      color: var(--text-color);
      border: 1px solid var(--border-color);
    }

    button.secondary:hover {
      background-color: var(--border-color);
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .summary-item {
      text-align: center;
      padding: 16px;
      background: var(--bg-color);
      border-radius: 8px;
    }

    .summary-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary-color);
    }

    .summary-label {
      font-size: 13px;
      color: var(--text-light);
      margin-top: 4px;
    }

    .heatmap-container {
      overflow-x: auto;
    }

    .heatmap {
      min-width: 100%;
    }

    .heatmap td {
      text-align: center;
      padding: 8px;
      font-size: 13px;
    }

    .heatmap td.good {
      background-color: #d4edda;
      color: #155724;
    }

    .heatmap td.moderate {
      background-color: #fff3cd;
      color: #856404;
    }

    .heatmap td.poor {
      background-color: #f8d7da;
      color: #721c24;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <h1>ETFè½®åŠ¨ç­–ç•¥ç ”ç©¶</h1>
          <p>åŸºäºå¤šå› å­æ¨¡å‹çš„ETFè½®åŠ¨ç­–ç•¥å›æµ‹ä¸åˆ†ææ¡†æ¶</p>
        </div>
        <div class="universe-selector">
          <label style="font-size: 14px; color: rgba(255,255,255,0.9);">ç ”ç©¶æ ‡çš„æ± :</label>
          <select id="universe-select" onchange="switchUniverse()" style="margin-left: 10px; padding: 8px 12px; border-radius: 6px; border: none;">
            <option value="crude_oil">åŸæ²¹ETF (7åª)</option>
            <option value="a_core">Aè‚¡æ ¸å¿ƒ (5åª)</option>
            <option value="sector">è¡Œä¸šè½®åŠ¨ (5åª)</option>
            <option value="custom">è‡ªå®šä¹‰...</option>
          </select>
        </div>
      </div>
    </header>

    <nav class="nav-tabs">
      <button class="nav-tab active" data-section="overview">ç­–ç•¥æ¦‚è§ˆ</button>
      <button class="nav-tab" data-section="results">å›æµ‹ç»“æœ</button>
      <button class="nav-tab" data-section="sensitivity">å‚æ•°æ•æ„Ÿæ€§</button>
      <button class="nav-tab" data-section="config">ç­–ç•¥é…ç½®</button>
      <button class="nav-tab" data-section="panic">ææ…Œæ‹©æ—¶è®¾ç½®</button>
      <button class="nav-tab" data-section="run">è¿è¡Œå›æµ‹</button>
      <button class="nav-tab" data-section="report">ç ”ç©¶æŠ¥å‘Š</button>
    </nav>

    <!-- ç­–ç•¥æ¦‚è§ˆ -->
    <section id="overview" class="section active">
      <div class="card">
        <h2 class="card-title">å½“å‰ç ”ç©¶æ ‡çš„æ± : <span id="universe-name">åŸæ²¹ETF</span></h2>
        <div class="etf-list" id="etf-list">
          <div class="etf-item">
            <div class="etf-code">501018</div>
            <div class="etf-name">å—æ–¹åŸæ²¹</div>
          </div>
          <div class="etf-item">
            <div class="etf-code">160723</div>
            <div class="etf-name">å˜‰å®åŸæ²¹</div>
          </div>
          <div class="etf-item">
            <div class="etf-code">161129</div>
            <div class="etf-name">æ˜“æ–¹è¾¾åŸæ²¹</div>
          </div>
          <div class="etf-item">
            <div class="etf-code">160416</div>
            <div class="etf-name">åå®‰çŸ³æ²¹</div>
          </div>
          <div class="etf-item">
            <div class="etf-code">162719</div>
            <div class="etf-name">å¹¿å‘çŸ³æ²¹</div>
          </div>
          <div class="etf-item">
            <div class="etf-code">163208</div>
            <div class="etf-name">è¯ºå®‰æ²¹æ°”</div>
          </div>
          <div class="etf-item">
            <div class="etf-code">162411</div>
            <div class="etf-name">åå®æ²¹æ°”</div>
          </div>
        </div>
        <div style="margin-top: 16px; padding: 12px; background: #e3f2fd; border-radius: 8px; color: #1565c0;">
          <strong>ğŸ’¡ æç¤º:</strong> å¯ä»¥ä½¿ç”¨"è¿è¡Œå›æµ‹"é¡µé¢é€‰æ‹©å…¶ä»–é¢„è®¾æ ‡çš„æ± æˆ–è‡ªå®šä¹‰ETFç»„åˆè¿›è¡Œè½®åŠ¨ç­–ç•¥ç ”ç©¶ã€‚
        </div>
      </div>

      <div class="card">
        <h2 class="card-title">å› å­ä½“ç³»</h2>
        <table>
          <thead>
            <tr>
              <th>å› å­ç±»åˆ«</th>
              <th>å› å­åç§°</th>
              <th>è®¡ç®—å…¬å¼</th>
              <th>è¯´æ˜</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="4"><strong>åŠ¨é‡å› å­</strong></td>
              <td>raw_mom</td>
              <td>Close(t)/Close(t-N) - 1</td>
              <td>åŸå§‹åŠ¨é‡</td>
            </tr>
            <tr>
              <td>sharpe_mom</td>
              <td>ç´¯è®¡æ”¶ç›Š / æ³¢åŠ¨ç‡</td>
              <td>é£é™©è°ƒæ•´åŠ¨é‡</td>
            </tr>
            <tr>
              <td>sortino_mom</td>
              <td>ç´¯è®¡æ”¶ç›Š / ä¸‹è¡Œæ³¢åŠ¨ç‡</td>
              <td>ä¸‹è¡Œé£é™©è°ƒæ•´</td>
            </tr>
            <tr>
              <td>return_over_vol</td>
              <td>æ”¶ç›Šç‡ / æ³¢åŠ¨ç‡</td>
              <td>ç®€åŒ–å¤æ™®</td>
            </tr>
            <tr>
              <td><strong>è¶‹åŠ¿å› å­</strong></td>
              <td>sma_trend</td>
              <td>Close / SMA(N) - 1</td>
              <td>å‡çº¿åç¦»åº¦</td>
            </tr>
            <tr>
              <td><strong>æ³¢åŠ¨ç‡å› å­</strong></td>
              <td>low_vol</td>
              <td>1 / æ³¢åŠ¨ç‡</td>
              <td>ä½æ³¢åŠ¨ä¼˜é€‰</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="card">
        <h2 class="card-title">å›æµ‹ç»Ÿè®¡</h2>
        <div class="grid">
          <div class="stat-card">
            <div class="stat-value" id="total-strategies">168</div>
            <div class="stat-label">æµ‹è¯•ç­–ç•¥æ•°</div>
          </div>
          <div class="stat-card danger">
            <div class="stat-value" id="sharpe-1">0</div>
            <div class="stat-label">å¤æ™® â‰¥ 1.0</div>
          </div>
          <div class="stat-card danger">
            <div class="stat-value" id="sharpe-1.3">0</div>
            <div class="stat-label">å¤æ™® â‰¥ 1.3</div>
          </div>
          <div class="stat-card danger">
            <div class="stat-value" id="return-28">0</div>
            <div class="stat-label">å¹´åŒ– â‰¥ 28%</div>
          </div>
          <div class="stat-card danger">
            <div class="stat-value" id="maxdd-15">0</div>
            <div class="stat-label">æœ€å¤§å›æ’¤ â‰¤ 15%</div>
          </div>
        </div>
        <div style="margin-top: 16px; padding: 16px; background: #fff3cd; border-radius: 8px; color: #856404;">
          <strong>âš ï¸ é‡è¦å‘ç°</strong><br>
          åœ¨168ç§ç­–ç•¥é…ç½®ä¸­ï¼Œæ²¡æœ‰ç­–ç•¥èƒ½åŒæ—¶æ»¡è¶³ï¼šå¤æ™®â‰¥1.0ã€å¹´åŒ–â‰¥28%ã€æœ€å¤§å›æ’¤â‰¤15%ã€‚<br>
          æœ€ä½³ç­–ç•¥å¤æ™®ä»…ä¸º0.344ï¼Œæœ€å¤§å›æ’¤çº¦-41%ã€‚<br>
          åŸæ²¹ETFçš„é«˜æ³¢åŠ¨ç‰¹æ€§ä½¿å¾—è¾¾æˆç›®æ ‡éå¸¸å›°éš¾ã€‚
        </div>
      </div>
    </section>

    <!-- å›æµ‹ç»“æœ -->
    <section id="results" class="section">
      <div class="card">
        <h2 class="card-title">å›æµ‹ç»“æœå¯¹æ¯”</h2>
        <div class="filter-row">
          <div class="filter-group">
            <label>è¯„åˆ†æ–¹æ³•</label>
            <select id="filter-score">
              <option value="">å…¨éƒ¨</option>
              <option value="raw_mom">raw_mom</option>
              <option value="sharpe_mom">sharpe_mom</option>
              <option value="sortino_mom">sortino_mom</option>
              <option value="return_over_vol">return_over_vol</option>
              <option value="multi_factor">multi_factor</option>
            </select>
          </div>
          <div class="filter-group">
            <label>å›çœ‹å¤©æ•°</label>
            <select id="filter-lookback">
              <option value="">å…¨éƒ¨</option>
              <option value="60">60å¤©</option>
              <option value="90">90å¤©</option>
              <option value="120">120å¤©</option>
              <option value="180">180å¤©</option>
            </select>
          </div>
          <div class="filter-group">
            <label>æŒä»“æ•°é‡</label>
            <select id="filter-topk">
              <option value="">å…¨éƒ¨</option>
              <option value="1">1åª</option>
              <option value="2">2åª</option>
              <option value="3">3åª</option>
            </select>
          </div>
          <div class="filter-group">
            <label>å†å¹³è¡¡é¢‘ç‡</label>
            <select id="filter-rebalance">
              <option value="">å…¨éƒ¨</option>
              <option value="daily">æ—¥åº¦</option>
              <option value="weekly">å‘¨åº¦</option>
              <option value="monthly">æœˆåº¦</option>
            </select>
          </div>
          <button onclick="applyFilters()">ç­›é€‰</button>
        </div>
        <table id="results-table">
          <thead>
            <tr>
              <th>ç­–ç•¥åç§°</th>
              <th>å¤æ™®æ¯”ç‡</th>
              <th>å¹´åŒ–æ”¶ç›Š</th>
              <th>æœ€å¤§å›æ’¤</th>
              <th>å¡å°”é©¬æ¯”ç‡</th>
              <th>Sortino</th>
              <th>èƒœç‡</th>
              <th>çŠ¶æ€</th>
            </tr>
          </thead>
          <tbody id="results-body">
            <tr>
              <td colspan="8" style="text-align: center; color: var(--text-light);">
                åŠ è½½ä¸­... è¯·è¿è¡Œ python -m etf_momentum.scripts.crude_oil_rotation_runner
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="card">
        <h2 class="card-title">æœ€ä½³ç­–ç•¥è¯¦æƒ…</h2>
        <div id="best-strategy-details">
          <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
            <h3 style="margin: 0 0 12px 0; color: var(--primary-color);">æœ€ä½³ç­–ç•¥: sharpe_mom_90d_top3_weekly</h3>
            <table>
              <tr><td style="padding: 8px 0;"><strong>å¤æ™®æ¯”ç‡:</strong></td><td>0.344</td></tr>
              <tr><td style="padding: 8px 0;"><strong>å¹´åŒ–æ”¶ç›Šç‡:</strong></td><td>11.5%</td></tr>
              <tr><td style="padding: 8px 0;"><strong>æœ€å¤§å›æ’¤:</strong></td><td style="color: var(--danger-color);">-40.9%</td></tr>
              <tr><td style="padding: 8px 0;"><strong>å¡å°”é©¬æ¯”ç‡:</strong></td><td>0.28</td></tr>
              <tr><td style="padding: 8px 0;"><strong>Sortinoæ¯”ç‡:</strong></td><td>0.48</td></tr>
              <tr><td style="padding: 8px 0;"><strong>èƒœç‡:</strong></td><td>54%</td></tr>
            </table>
          </div>
          <div style="background: #fff3cd; padding: 16px; border-radius: 8px; color: #856404;">
            <strong>âš ï¸ ç›®æ ‡æœªè¾¾æˆ</strong><br>
            è¯¥ç­–ç•¥è·ç¦»ç›®æ ‡(å¤æ™®â‰¥1.3, å¹´åŒ–â‰¥28%, æœ€å¤§å›æ’¤â‰¤15%)ä»æœ‰è¾ƒå¤§å·®è·ã€‚<br>
            åŸæ²¹ETFçš„é«˜æ³¢åŠ¨ç‰¹æ€§ä½¿å¾—åŒæ—¶æ»¡è¶³é«˜æ”¶ç›Šå’Œä½å›æ’¤éå¸¸å›°éš¾ã€‚
          </div>
        </div>
      </div>
    </section>

    <!-- å‚æ•°æ•æ„Ÿæ€§ -->
    <section id="sensitivity" class="section">
      <div class="card">
        <h2 class="card-title">å›çœ‹å¤©æ•°æ•æ„Ÿæ€§åˆ†æ</h2>
        <div class="heatmap-container">
          <table class="heatmap">
            <thead>
              <tr>
                <th>å›çœ‹å¤©æ•°</th>
                <th>å¹³å‡å¤æ™®</th>
                <th>æœ€ä¼˜å¤æ™®</th>
                <th>æœ€ä¼˜ç­–ç•¥</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>60å¤©</td><td>0.23</td><td class="good">0.344</td><td>raw_mom/sharpe_mom top3</td></tr>
              <tr><td>90å¤©</td><td>0.22</td><td class="good">0.344</td><td>sharpe_mom/return_over_vol</td></tr>
              <tr><td>120å¤©</td><td>0.18</td><td>0.286</td><td>raw_mom_top3</td></tr>
              <tr><td>180å¤©</td><td>0.15</td><td>0.267</td><td>raw_mom_top3</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <h2 class="card-title">æŒä»“æ•°é‡æ•æ„Ÿæ€§åˆ†æ</h2>
        <div class="heatmap-container">
          <table class="heatmap">
            <thead>
              <tr>
                <th>æŒä»“æ•°é‡</th>
                <th>å¹³å‡å¤æ™®</th>
                <th>æœ€ä¼˜å¤æ™®</th>
                <th>æœ€ä¼˜ç­–ç•¥</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>1åª</td><td>0.16</td><td>0.267</td><td>sharpe_mom_180d</td></tr>
              <tr><td>2åª</td><td>0.19</td><td>0.344</td><td>sharpe_mom_90d</td></tr>
              <tr><td>3åª</td><td>0.25</td><td class="good">0.344</td><td>sharpe_mom_90d</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <h2 class="card-title">å¤šå› å­æƒé‡æ•æ„Ÿæ€§</h2>
        <div class="heatmap-container">
          <table class="heatmap" id="weight-heatmap">
            <thead>
              <tr>
                <th>åŠ¨é‡æƒé‡</th>
                <th>è¶‹åŠ¿æƒé‡</th>
                <th>æ³¢åŠ¨ç‡æƒé‡</th>
                <th>å¤æ™®æ¯”ç‡</th>
                <th>å¹´åŒ–æ”¶ç›Š</th>
              </tr>
            </thead>
            <tbody id="weight-body">
              <tr>
                <td colspan="5" style="text-align: center; color: var(--text-light);">è¿è¡Œå›æµ‹åæŸ¥çœ‹</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- ç­–ç•¥é…ç½® -->
    <section id="config" class="section">
      <div class="card">
        <h2 class="card-title">å½“å‰æ¨èç­–ç•¥é…ç½®</h2>
        <div class="code-block" id="optimal-config">
{
  "strategy_name": "sharpe_mom_90d_top3_weekly",
  "codes": [
    "501018", "160723", "161129", "160416",
    "162719", "163208", "162411"
  ],
  "score_method": "sharpe_mom",
  "lookback_days": 90,
  "top_k": 3,
  "rebalance": "weekly",
  "enable_trend_filter": false,
  "sma_period": 50,
  "cost_bps": 3.0,
  "expected_metrics": {
    "sharpe_ratio": 0.344,
    "annualized_return": "11.5%",
    "max_drawdown": "-40.9%"
  },
  "note": "ç›®æ ‡æœªè¾¾æˆï¼Œæ­¤ä¸ºå›æµ‹æœ€ä½³è¡¨ç°"
}
        </div>
        <div style="margin-top: 16px;">
          <button onclick="copyConfig()">å¤åˆ¶é…ç½®</button>
        </div>
      </div>

      <div class="card">
        <h2 class="card-title">è¿è¡Œå›æµ‹è„šæœ¬</h2>
        <p>åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿è¡Œå®Œæ•´å›æµ‹ï¼š</p>
        <div class="code-block">
cd /path/to/momentum
python -m etf_momentum.scripts.crude_oil_rotation_runner
        </div>
        <p style="margin-top: 16px; color: var(--text-light);">
          å›æµ‹ç»“æœå°†ä¿å­˜è‡³ <code>data/crude_oil/</code> ç›®å½•ï¼ŒåŒ…æ‹¬ï¼š
        </p>
        <ul style="color: var(--text-light);">
          <li><code>all_results.csv</code> - æ‰€æœ‰ç­–ç•¥å›æµ‹ç»“æœ</li>
          <li><code>single_factor_results.csv</code> - å•å› å­ç­–ç•¥ç»“æœ</li>
          <li><code>multi_factor_results.csv</code> - å¤šå› å­ç­–ç•¥ç»“æœ</li>
          <li><code>crude_oil_rotation_report.md</code> - ç ”ç©¶æŠ¥å‘Š</li>
        </ul>
      </div>
    </section>

    <!-- ææ…Œæ‹©æ—¶è®¾ç½® -->
    <section id="panic" class="section">
      <div class="card">
        <h2 class="card-title">ææ…ŒæŒ‡æ•°æ‹©æ—¶è®¾ç½®</h2>
        <div style="background: #e3f2fd; padding: 16px; border-radius: 8px; margin-bottom: 20px; color: #1565c0;">
          <strong>OVXï¼ˆåŸæ²¹æ³¢åŠ¨ç‡ææ…ŒæŒ‡æ•°ï¼‰æ‹©æ—¶é…ç½®</strong><br>
          åŸºäº Cboe OVX æŒ‡æ•°ä¸º <strong>160723 å˜‰å®åŸæ²¹</strong> è®¾ç½®ææ…Œæ‹©æ—¶ç­–ç•¥
        </div>
      </div>

      <div class="card">
        <h3 class="card-title">ç›®æ ‡ETFé…ç½®</h3>
        <div class="etf-list" style="max-width: 400px;">
          <div class="etf-item">
            <div class="etf-code">160723</div>
            <div class="etf-name">å˜‰å®åŸæ²¹ï¼ˆOVXææ…Œæ‹©æ—¶ä¸“ç”¨ï¼‰</div>
          </div>
        </div>
      </div>

      <div class="card">
        <h3 class="card-title">ææ…ŒæŒ‡æ•°å‚æ•°</h3>
        <div class="filter-row">
          <div class="filter-group">
            <label>ææ…ŒæŒ‡æ•°</label>
            <select id="panic-index">
              <option value="OVX" selected>OVXï¼ˆåŸæ²¹æ³¢åŠ¨ç‡ææ…ŒæŒ‡æ•°ï¼‰</option>
              <option value="VIX">VIXï¼ˆæ ‡æ™®500ææ…ŒæŒ‡æ•°ï¼‰</option>
            </select>
          </div>
          <div class="filter-group">
            <label>æ•°æ®æº</label>
            <select id="panic-provider">
              <option value="cboe" selected>CBOE</option>
              <option value="yahoo">Yahoo Finance</option>
            </select>
          </div>
          <div class="filter-group">
            <label>æ—¥æœŸå¯¹é½</label>
            <select id="panic-align">
              <option value="cn_next_trading_day" selected>ç¾è‚¡æ”¶ç›˜é¡ºå»¶åˆ°Aè‚¡ä¸‹ä¸€äº¤æ˜“æ—¥</option>
              <option value="none">ä¸åšé¡ºå»¶ï¼ˆåŸå§‹æ—¥æœŸï¼‰</option>
            </select>
          </div>
        </div>
      </div>

      <div class="card">
        <h3 class="card-title">æ‹©æ—¶é˜ˆå€¼è®¾ç½®</h3>
        <div class="filter-row">
          <div class="filter-group">
            <label>OVXé«˜ä½é˜ˆå€¼ï¼ˆåˆ†ä½æ•°ï¼‰</label>
            <input type="number" id="panic-high-q" value="0.8" step="0.05" min="0.5" max="0.99" style="width: 100px;">
            <span class="muted" style="font-size: 12px;">OVXè¶…è¿‡æ­¤åˆ†ä½æ•°æ—¶å‡ä»“</span>
          </div>
          <div class="filter-group">
            <label>OVXä½ä½é˜ˆå€¼ï¼ˆåˆ†ä½æ•°ï¼‰</label>
            <input type="number" id="panic-low-q" value="0.3" step="0.05" min="0.01" max="0.5" style="width: 100px;">
            <span class="muted" style="font-size: 12px;">OVXä½äºæ­¤åˆ†ä½æ•°æ—¶æ¢å¤æ­£å¸¸ä»“ä½</span>
          </div>
        </div>
        <div class="filter-row">
          <div class="filter-group">
            <label>ææ…ŒæœŸé—´ä»“ä½</label>
            <input type="number" id="panic-high-pct" value="0.3" step="0.1" min="0" max="1" style="width: 100px;">
            <span class="muted" style="font-size: 12px;">é«˜ä½æ—¶æŒä»“æ¯”ä¾‹</span>
          </div>
          <div class="filter-group">
            <label>æ­£å¸¸ä»“ä½</label>
            <input type="number" id="panic-normal-pct" value="1.0" step="0.1" min="0" max="1" style="width: 100px;">
            <span class="muted" style="font-size: 12px;">ä½ä½/æ­£å¸¸æ—¶æŒä»“æ¯”ä¾‹</span>
          </div>
          <div class="filter-group">
            <label>åˆ†ä½æ•°çª—å£</label>
            <select id="panic-window">
              <option value="all">å…¨åŒºé—´ï¼ˆæ— å‰è§†ï¼‰</option>
              <option value="1y">è¿‘1å¹´æ»šåŠ¨</option>
              <option value="3y">è¿‘3å¹´æ»šåŠ¨</option>
              <option value="5y" selected>è¿‘5å¹´æ»šåŠ¨</option>
            </select>
          </div>
        </div>
      </div>

      <div class="card">
        <h3 class="card-title">äº¤æ˜“æˆæœ¬ä¸å›æµ‹è®¾ç½®</h3>
        <div class="filter-row">
          <div class="filter-group">
            <label>äº¤æ˜“æˆæœ¬ï¼ˆbps/æ¢ä»“ï¼‰</label>
            <input type="number" id="panic-cost" value="10" step="1" min="0" style="width: 100px;">
          </div>
          <div class="filter-group">
            <label>å¼€å§‹æ—¥æœŸ</label>
            <input type="text" id="panic-start" placeholder="YYYYMMDD" value="20170101" style="width: 120px;">
          </div>
          <div class="filter-group">
            <label>ç»“æŸæ—¥æœŸ</label>
            <input type="text" id="panic-end" placeholder="YYYYMMDD" style="width: 120px;">
          </div>
        </div>
      </div>

      <div class="card">
        <h3 class="card-title">å›æµ‹å‘½ä»¤</h3>
        <div class="code-block" id="panic-command">
# è¿è¡Œ OVX ææ…Œæ‹©æ—¶å›æµ‹ï¼ˆ160723 å˜‰å®åŸæ²¹ï¼‰
python -m etf_momentum.scripts.crude_oil_rotation_runner --etf 160723 --index OVX --high-q 0.8 --low-q 0.3 --high-pct 0.3 --window 5y

# è¿è¡Œ VIX ææ…Œæ‹©æ—¶å›æµ‹
python -m etf_momentum.scripts.crude_oil_rotation_runner --etf 160723 --index VIX --high-q 0.85 --low-q 0.25 --high-pct 0.5
        </div>
        <div style="margin-top: 16px;">
          <button onclick="copyPanicCommand()">å¤åˆ¶å‘½ä»¤</button>
        </div>
      </div>

      <div class="card">
        <h3 class="card-title">æ‹©æ—¶ç­–ç•¥è¯´æ˜</h3>
        <table>
          <thead>
            <tr>
              <th>å¸‚åœºçŠ¶æ€</th>
              <th>OVXåˆ†ä½æ•°</th>
              <th>æ“ä½œ</th>
              <th>è¯´æ˜</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><span class="badge badge-danger">ææ…Œ</span></td>
              <td>â‰¥ 80%</td>
              <td>å‡ä»“è‡³30%</td>
              <td>å¸‚åœºææ…Œæ—¶é™ä½æ•å£</td>
            </tr>
            <tr>
              <td><span class="badge badge-success">æ­£å¸¸</span></td>
              <td>&lt; 30%</td>
              <td>æ¢å¤æ»¡ä»“</td>
              <td>ææ…Œæƒ…ç»ªæ¶ˆé€€ååŠ å›</td>
            </tr>
            <tr>
              <td><span class="badge badge-warning">è§‚æœ›</span></td>
              <td>30% - 80%</td>
              <td>ç»´æŒå½“å‰ä»“ä½</td>
              <td>ä¸åšè°ƒæ•´</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- è¿è¡Œå›æµ‹ -->
    <section id="run" class="section">
      <div class="card">
        <h2 class="card-title">è¿è¡Œè½®åŠ¨ç­–ç•¥å›æµ‹</h2>
        
        <div class="filter-row" style="margin-bottom: 24px;">
          <div class="filter-group">
            <label>é€‰æ‹©é¢„è®¾æ ‡çš„æ± </label>
            <select id="run-universe" onchange="updateUniverseInfo()">
              <option value="crude_oil">åŸæ²¹ETF (7åª)</option>
              <option value="a_core">Aè‚¡æ ¸å¿ƒ (5åª)</option>
              <option value="sector">è¡Œä¸šè½®åŠ¨ (5åª)</option>
            </select>
          </div>
          <div class="filter-group">
            <label>æˆ–è¾“å…¥è‡ªå®šä¹‰ETFä»£ç </label>
            <input type="text" id="custom-codes" placeholder="510300,510500,510880" style="width: 250px;">
          </div>
          <div class="filter-group">
            <label>å›æµ‹åç§°</label>
            <input type="text" id="run-name" placeholder="è‡ªå®šä¹‰ç ”ç©¶" style="width: 150px;">
          </div>
        </div>

        <div class="card" style="background: #f8f9fa;">
          <h3 style="margin: 0 0 16px 0; color: var(--primary-color);">å½“å‰é…ç½®</h3>
          <div id="run-config-info" style="font-size: 14px; color: var(--text-light);">
            <p><strong>æ ‡çš„æ± :</strong> <span id="selected-codes">501018, 160723, 161129, 160416, 162719, 163208, 162411</span></p>
            <p><strong>è¯„åˆ†æ–¹æ³•:</strong> sharpe_mom, raw_mom, sma_trend, low_vol, multi_factor</p>
            <p><strong>å‚æ•°èŒƒå›´:</strong> å›çœ‹å¤©æ•°(60/90/120/180å¤©), æŒä»“æ•°é‡(1/2/3åª), å†å¹³è¡¡é¢‘ç‡(æ—¥/å‘¨/æœˆ)</p>
            <p><strong>äº¤æ˜“æˆæœ¬:</strong> 3bps (åŒè¾¹)</p>
          </div>
        </div>

        <div style="margin-top: 24px;">
          <h3 style="margin-bottom: 16px;">è¿è¡Œå‘½ä»¤</h3>
          <div class="code-block" id="run-command">
# ä½¿ç”¨é¢„è®¾æ ‡çš„æ± 
python -m etf_momentum.scripts.rotation_research_runner -u crude_oil

# ä½¿ç”¨è‡ªå®šä¹‰ETF
python -m etf_momentum.scripts.rotation_research_runner -c "510300,510500" -n "æˆ‘çš„ç­–ç•¥"

# å¿«é€Ÿå‚æ•°æ•æ„Ÿæ€§æµ‹è¯•
python -m etf_momentum.scripts.rotation_research_runner -u crude_oil -q
          </div>
          <div style="margin-top: 16px;">
            <button onclick="copyRunCommand()">å¤åˆ¶å‘½ä»¤</button>
            <span style="margin-left: 16px; color: var(--text-light); font-size: 14px;">
              å›æµ‹ç»“æœå°†ä¿å­˜è‡³ <code>data/rotation_research/</code> ç›®å½•
            </span>
          </div>
        </div>

        <div style="margin-top: 24px; padding: 16px; background: #fff3cd; border-radius: 8px; color: #856404;">
          <strong>âš ï¸ æ³¨æ„äº‹é¡¹</strong>
          <ul style="margin: 8px 0 0 0;">
            <li>é¦–æ¬¡è¿è¡Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´å®Œæˆæ•°æ®åŠ è½½å’Œå›æµ‹</li>
            <li>å›æµ‹å®Œæˆåè¯·åˆ·æ–°é¡µé¢æŸ¥çœ‹æœ€æ–°ç»“æœ</li>
            <li>è‡ªå®šä¹‰ETFéœ€è¦ç¡®ä¿ä»£ç å­˜åœ¨äºæ•°æ®åº“ä¸­</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- ç ”ç©¶æŠ¥å‘Š -->
    <section id="report" class="section">
      <div class="card">
        <h2 class="card-title">åŸæ²¹è½®åŠ¨ç­–ç•¥ç ”ç©¶æŠ¥å‘Šæ‘˜è¦</h2>
        <div id="report-content" style="max-height: 600px; overflow-y: auto;">
          <h3>å›æµ‹æ¦‚è§ˆ</h3>
          <ul>
            <li>æµ‹è¯•ç­–ç•¥æ€»æ•°: 168ç§é…ç½®</li>
            <li>å›æµ‹åŒºé—´: 2017-05-05 è‡³ 2026-02-09 (çº¦9å¹´)</li>
            <li>æ ‡çš„æ± : 7åªåŸæ²¹/æ²¹æ°”ETF</li>
          </ul>
          
          <h3>å…³é”®å‘ç°</h3>
          <div style="background: #f8d7da; padding: 16px; border-radius: 8px; margin: 16px 0;">
            <strong>âš ï¸ ç›®æ ‡æœªè¾¾æˆ</strong><br>
            åœ¨168ç§ç­–ç•¥ä¸­ï¼Œæ²¡æœ‰ç­–ç•¥èƒ½åŒæ—¶æ»¡è¶³ï¼š<br>
            â€¢ å¤æ™®æ¯”ç‡ â‰¥ 1.0<br>
            â€¢ å¹´åŒ–æ”¶ç›Šç‡ â‰¥ 28%<br>
            â€¢ æœ€å¤§å›æ’¤ â‰¤ 15%
          </div>
          
          <h3>æœ€ä½³ç­–ç•¥ç»©æ•ˆ</h3>
          <table>
            <tr><td>ç­–ç•¥åç§°</td><td>sharpe_mom_90d_top3_weekly</td></tr>
            <tr><td>å¤æ™®æ¯”ç‡</td><td>0.344</td></tr>
            <tr><td>å¹´åŒ–æ”¶ç›Šç‡</td><td>11.5%</td></tr>
            <tr><td>æœ€å¤§å›æ’¤</td><td style="color: var(--danger-color);">-40.9%</td></tr>
          </table>
          
          <h3>åŸå› åˆ†æ</h3>
          <ul>
            <li><strong>åŸæ²¹å¸‚åœºç‰¹æ€§</strong>: é«˜åº¦æ³¢åŠ¨ï¼Œå•æ—¥å¯è¾¾5-10%</li>
            <li><strong>2020å¹´è´Ÿæ²¹ä»·</strong>: å¯¼è‡´æç«¯å›æ’¤</li>
            <li><strong>æ ‡çš„é«˜åº¦ç›¸å…³</strong>: 7åªETFç›¸å…³ç³»æ•°>0.8</li>
          </ul>
          
          <h3>æ”¹è¿›å»ºè®®</h3>
          <ul>
            <li>é™ä½æ”¶ç›Šé¢„æœŸ (å¹´åŒ–8-12%è¾ƒä¸ºåˆç†)</li>
            <li>æ”¾å®½å›æ’¤é™åˆ¶ (30-40%)</li>
            <li>å¼•å…¥å¯¹å†²ç­–ç•¥æˆ–æœŸæƒä¿æŠ¤</li>
            <li>å°†åŸæ²¹ä½œä¸ºèµ„äº§é…ç½®çš„ä¸€éƒ¨åˆ†</li>
          </ul>
          
          <p style="color: var(--text-light); margin-top: 24px;">
            å®Œæ•´æŠ¥å‘Š: <code>data/crude_oil/crude_oil_rotation_report.md</code>
          </p>
        </div>
      </div>
    </section>
  </div>

  <script>
    const UNIVERSE_CONFIGS = {
      crude_oil: {
        name: 'åŸæ²¹ETF',
        codes: ['501018', '160723', '161129', '160416', '162719', '163208', '162411'],
        description: '7åªåŸæ²¹/æ²¹æ°”LOF',
        dataDir: 'crude_oil'
      },
      a_core: {
        name: 'Aè‚¡æ ¸å¿ƒ',
        codes: ['510300', '510500', '510880', '510900', '511660'],
        description: 'æ ¸å¿ƒAè‚¡ETF',
        dataDir: 'a_core'
      },
      sector: {
        name: 'è¡Œä¸šè½®åŠ¨',
        codes: ['512880', '512690', '512760', '512800', '512780'],
        description: '5å¤§è¡Œä¸šETF',
        dataDir: 'sector'
      }
    };

    let currentUniverse = 'crude_oil';
    let currentResults = [];

    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.section).classList.add('active');
      });
    });

    function switchUniverse() {
      const selector = document.getElementById('universe-select');
      currentUniverse = selector.value;
      
      const config = UNIVERSE_CONFIGS[currentUniverse];
      if (config) {
        document.getElementById('universe-name').textContent = config.name;
        renderEtfList(config.codes);
        loadResults(config.dataDir);
      }
    }

    function renderEtfList(codes) {
      const list = document.getElementById('etf-list');
      const names = {
        '501018': 'å—æ–¹åŸæ²¹', '160723': 'å˜‰å®åŸæ²¹', '161129': 'æ˜“æ–¹è¾¾åŸæ²¹',
        '160416': 'åå®‰çŸ³æ²¹', '162719': 'å¹¿å‘çŸ³æ²¹', '163208': 'è¯ºå®‰æ²¹æ°”',
        '162411': 'åå®æ²¹æ°”', '510300': 'æ²ªæ·±300', '510500': 'ä¸­è¯500',
        '510880': 'åˆ›ä¸šæ¿æŒ‡', '510900': 'ä¸­è¯1000', '511660': 'ä¸­è¯800',
        '512880': 'è¯åˆ¸ETF', '512690': 'é“¶è¡ŒETF', '512760': 'åˆ¸å•†ETF',
        '512800': 'ä¿é™©ETF', '512780': 'åœ°äº§ETF'
      };
      
      list.innerHTML = codes.map(code => `
        <div class="etf-item">
          <div class="etf-code">${code}</div>
          <div class="etf-name">${names[code] || code}</div>
        </div>
      `).join('');
    }

    function updateUniverseInfo() {
      const universe = document.getElementById('run-universe').value;
      const config = UNIVERSE_CONFIGS[universe];
      if (config) {
        document.getElementById('selected-codes').textContent = config.codes.join(', ');
      }
    }

    function copyRunCommand() {
      const universe = document.getElementById('run-universe').value;
      const customCodes = document.getElementById('custom-codes').value.trim();
      const name = document.getElementById('run-name').value.trim();
      
      let command;
      if (customCodes) {
        command = `python -m etf_momentum.scripts.rotation_research_runner -c "${customCodes}" -n "${name || 'Custom'}"`;
      } else {
        command = `python -m etf_momentum.scripts.rotation_research_runner -u ${universe}`;
      }
      
      navigator.clipboard.writeText(command).then(() => {
        alert('è¿è¡Œå‘½ä»¤å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
      });
    }

    function loadResults(dataDir) {
      const resultsPath = `data/rotation_research/${dataDir}/all_results.csv`;
      
      fetch(resultsPath)
        .then(response => {
          if (!response.ok) {
            throw new Error('File not found');
          }
          return response.text();
        })
        .then(csv => {
          parseAndDisplayResults(csv);
        })
        .catch(() => {
          const fallbackPath = `data/${dataDir}/all_results.csv`;
          fetch(fallbackPath)
            .then(response => response.text())
            .then(csv => parseAndDisplayResults(csv))
            .catch(() => {
              console.log('No results file found, using sample data');
              loadSampleData();
            });
        });
    }

    function parseAndDisplayResults(csv) {
      const lines = csv.trim().split('\n');
      const headers = lines[0].split(',');
      
      currentResults = lines.slice(1).map(line => {
        const values = line.split(',');
        const obj = {};
        headers.forEach((h, i) => {
          obj[h] = values[i];
        });
        return obj;
      });
      
      updateResultsTable(currentResults);
      updateStatistics(currentResults);
      updateBestStrategy(currentResults);
    }

    function loadSampleData() {
      const sampleData = [
        { strategy_name: 'sharpe_mom_90d_top3_weekly', 'metrics.sharpe_ratio': '0.344', 'metrics.annualized_return': '0.115', 'metrics.max_drawdown': '-0.409', 'metrics.calmar_ratio': '0.28', 'metrics.sortino_ratio': '0.48', 'metrics.win_rate': '0.54' },
        { strategy_name: 'return_over_vol_90d_top3_weekly', 'metrics.sharpe_ratio': '0.344', 'metrics.annualized_return': '0.115', 'metrics.max_drawdown': '-0.409', 'metrics.calmar_ratio': '0.28', 'metrics.sortino_ratio': '0.48', 'metrics.win_rate': '0.54' },
        { strategy_name: 'raw_mom_60d_top3_weekly', 'metrics.sharpe_ratio': '0.316', 'metrics.annualized_return': '0.109', 'metrics.max_drawdown': '-0.420', 'metrics.calmar_ratio': '0.26', 'metrics.sortino_ratio': '0.43', 'metrics.win_rate': '0.53' },
        { strategy_name: 'sortino_mom_90d_top3_weekly', 'metrics.sharpe_ratio': '0.312', 'metrics.annualized_return': '0.107', 'metrics.max_drawdown': '-0.429', 'metrics.calmar_ratio': '0.25', 'metrics.sortino_ratio': '0.45', 'metrics.win_rate': '0.52' },
        { strategy_name: 'raw_mom_90d_top3_weekly', 'metrics.sharpe_ratio': '0.303', 'metrics.annualized_return': '0.105', 'metrics.max_drawdown': '-0.391', 'metrics.calmar_ratio': '0.27', 'metrics.sortino_ratio': '0.42', 'metrics.win_rate': '0.52' },
      ];
      currentResults = sampleData;
      updateResultsTable(sampleData);
      updateStatistics(sampleData);
      updateBestStrategy(sampleData);
    }

    function updateResultsTable(data) {
      const tbody = document.getElementById('results-body');
      if (!tbody) return;
      
      tbody.innerHTML = data.slice(0, 50).map(row => {
        const sharpe = parseFloat(row['metrics.sharpe_ratio'] || 0);
        const ret = parseFloat(row['metrics.annualized_return'] || 0) * 100;
        const maxdd = parseFloat(row['metrics.max_drawdown'] || 0) * 100;
        const calmar = parseFloat(row['metrics.calmar_ratio'] || 0);
        const sortino = parseFloat(row['metrics.sortino_ratio'] || 0);
        const winRate = parseFloat(row['metrics.win_rate'] || 0) * 100;
        
        let badgeClass = sharpe >= 1.3 ? 'badge-success' : sharpe >= 1.0 ? 'badge-warning' : 'badge-danger';
        let badgeText = sharpe >= 1.3 ? 'ä¼˜ç§€' : sharpe >= 1.0 ? 'è‰¯å¥½' : 'ä¸€èˆ¬';
        
        return `<tr>
          <td><strong>${row.strategy_name}</strong></td>
          <td>${sharpe.toFixed(3)}</td>
          <td style="color: ${ret >= 28 ? 'var(--success-color)' : 'inherit'}">${ret.toFixed(1)}%</td>
          <td style="color: ${maxdd >= -15 ? 'var(--success-color)' : 'var(--danger-color)'}">${maxdd.toFixed(1)}%</td>
          <td>${calmar.toFixed(2)}</td>
          <td>${sortino.toFixed(2)}</td>
          <td>${winRate.toFixed(1)}%</td>
          <td><span class="badge ${badgeClass}">${badgeText}</span></td>
        </tr>`;
      }).join('');
    }

    function updateStatistics(data) {
      const total = data.length;
      const sharpe1 = data.filter(r => parseFloat(r['metrics.sharpe_ratio'] || 0) >= 1.0).length;
      const sharpe13 = data.filter(r => parseFloat(r['metrics.sharpe_ratio'] || 0) >= 1.3).length;
      const ret28 = data.filter(r => parseFloat(r['metrics.annualized_return'] || 0) >= 0.28).length;
      const maxdd15 = data.filter(r => parseFloat(r['metrics.max_drawdown'] || 0) >= -0.15).length;
      
      const totalEl = document.getElementById('total-strategies');
      if (totalEl) totalEl.textContent = total;
      
      const el = id => document.getElementById(id);
      if (el('sharpe-1')) el('sharpe-1').textContent = sharpe1;
      if (el('sharpe-1.3')) el('sharpe-1.3').textContent = sharpe13;
      if (el('return-28')) el('return-28').textContent = ret28;
      if (el('maxdd-15')) el('maxdd-15').textContent = maxdd15;
    }

    function updateBestStrategy(data) {
      const best = data.reduce((prev, curr) => {
        return (parseFloat(curr['metrics.sharpe_ratio'] || 0) > parseFloat(prev['metrics.sharpe_ratio'] || 0)) ? curr : prev;
      }, data[0] || {});
      
      const details = document.getElementById('best-strategy-details');
      if (details && best.strategy_name) {
        const sharpe = parseFloat(best['metrics.sharpe_ratio'] || 0);
        const ret = parseFloat(best['metrics.annualized_return'] || 0) * 100;
        const maxdd = parseFloat(best['metrics.max_drawdown'] || 0) * 100;
        const calmar = parseFloat(best['metrics.calmar_ratio'] || 0);
        const sortino = parseFloat(best['metrics.sortino_ratio'] || 0);
        const winRate = parseFloat(best['metrics.win_rate'] || 0) * 100;
        
        details.innerHTML = `
          <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
            <h3 style="margin: 0 0 12px 0; color: var(--primary-color);">æœ€ä½³ç­–ç•¥: ${best.strategy_name}</h3>
            <table>
              <tr><td style="padding: 8px 0;"><strong>å¤æ™®æ¯”ç‡:</strong></td><td>${sharpe.toFixed(3)}</td></tr>
              <tr><td style="padding: 8px 0;"><strong>å¹´åŒ–æ”¶ç›Šç‡:</strong></td><td>${ret.toFixed(1)}%</td></tr>
              <tr><td style="padding: 8px 0;"><strong>æœ€å¤§å›æ’¤:</strong></td><td style="color: var(--danger-color);">${maxdd.toFixed(1)}%</td></tr>
              <tr><td style="padding: 8px 0;"><strong>å¡å°”é©¬æ¯”ç‡:</strong></td><td>${calmar.toFixed(2)}</td></tr>
              <tr><td style="padding: 8px 0;"><strong>Sortinoæ¯”ç‡:</strong></td><td>${sortino.toFixed(2)}</td></tr>
              <tr><td style="padding: 8px 0;"><strong>èƒœç‡:</strong></td><td>${winRate.toFixed(1)}%</td></tr>
            </table>
          </div>
          <div style="background: ${ret >= 28 && maxdd >= -15 ? '#d4edda' : '#fff3cd'}; padding: 16px; border-radius: 8px; color: ${ret >= 28 && maxdd >= -15 ? '#155724' : '#856404'};">
            <strong>${ret >= 28 && maxdd >= -15 ? 'âœ… ç›®æ ‡è¾¾æˆ' : 'âš ï¸ ç›®æ ‡æœªè¾¾æˆ'}</strong><br>
            ${ret >= 28 && maxdd >= -15 
              ? 'è¯¥ç­–ç•¥å·²æ»¡è¶³å¹´åŒ–æ”¶ç›Šâ‰¥28%ä¸”æœ€å¤§å›æ’¤â‰¤15%çš„ç›®æ ‡' 
              : `è¯¥ç­–ç•¥è·ç¦»ç›®æ ‡(å¤æ™®â‰¥1.3, å¹´åŒ–â‰¥28%, æœ€å¤§å›æ’¤â‰¤15%)ä»æœ‰å·®è·ã€‚`}
          </div>
        `;
      }
    }

    function applyFilters() {
      const score = document.getElementById('filter-score')?.value;
      const lookback = document.getElementById('filter-lookback')?.value;
      const topk = document.getElementById('filter-topk')?.value;
      const rebalance = document.getElementById('filter-rebalance')?.value;
      
      let filtered = currentResults;
      if (score) filtered = filtered.filter(r => r.params?.includes(`'${score}'`));
      if (lookback) filtered = filtered.filter(r => r.params?.includes(`${lookback}d`));
      if (topk) filtered = filtered.filter(r => r.strategy_name?.includes(`top${topk}`));
      if (rebalance) filtered = filtered.filter(r => r.strategy_name?.includes(rebalance));
      
      updateResultsTable(filtered);
    }

    function copyConfig() {
      const config = document.getElementById('optimal-config')?.textContent;
      if (config) {
        navigator.clipboard.writeText(config).then(() => {
          alert('é…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        });
      }
    }

    function copyPanicCommand() {
      const index = document.getElementById('panic-index')?.value || 'OVX';
      const highQ = document.getElementById('panic-high-q')?.value || '0.8';
      const lowQ = document.getElementById('panic-low-q')?.value || '0.3';
      const highPct = document.getElementById('panic-high-pct')?.value || '0.3';
      const window = document.getElementById('panic-window')?.value || '5y';
      
      const command = `python -m etf_momentum.scripts.crude_oil_rotation_runner --etf 160723 --index ${index} --high-q ${highQ} --low-q ${lowQ} --high-pct ${highPct} --window ${window}`;
      
      navigator.clipboard.writeText(command).then(() => {
        alert('å›æµ‹å‘½ä»¤å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadResults('crude_oil');
      updateUniverseInfo();
    });
  </script>
</body>
</html>
