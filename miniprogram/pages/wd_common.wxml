<view class="page">
  <view class="card">
    <view class="row">
      <view class="title">{{title}}</view>
      <view class="muted">{{rangeLabel}}</view>
    </view>
    <view class="row" style="margin-top: 10rpx; flex-wrap: wrap; justify-content:flex-start;">
      <button size="mini" bindtap="setRange" data-k="1m">近一月</button>
      <button size="mini" bindtap="setRange" data-k="3m">近三月</button>
      <button size="mini" bindtap="setRange" data-k="6m">近半年</button>
      <button size="mini" bindtap="setRange" data-k="1y">近一年</button>
      <button size="mini" bindtap="setRange" data-k="3y">近三年</button>
      <button size="mini" bindtap="setRange" data-k="5y">近五年</button>
      <button size="mini" bindtap="setRange" data-k="10y">近十年</button>
      <button size="mini" bindtap="setRange" data-k="all">全区间</button>
    </view>
    <view class="muted" style="margin-top: 8rpx;">{{status}}</view>
  </view>

  <view class="card">
    <view class="title">图表1：等权净值（log）+ EMA252 + 布林带</view>
    <canvas canvas-id="cNav" id="cNav" style="width: 100%; height: 300rpx;"></canvas>
  </view>

  <view class="card">
    <view class="title">图表2：回撤</view>
    <canvas canvas-id="cDD" id="cDD" style="width: 100%; height: 240rpx;"></canvas>
  </view>

  <view class="card">
    <view class="title">图表3：RSI(24)</view>
    <canvas canvas-id="cRSI" id="cRSI" style="width: 100%; height: 220rpx;"></canvas>
  </view>

  <view class="card">
    <view class="title">图表4：滚动三年收益率</view>
    <canvas canvas-id="cRR3Y" id="cRR3Y" style="width: 100%; height: 220rpx;"></canvas>
  </view>

  <view class="card">
    <view class="title">图表5：滚动三年回撤</view>
    <canvas canvas-id="cRDD3Y" id="cRDD3Y" style="width: 100%; height: 220rpx;"></canvas>
  </view>

  <view class="card">
    <view class="title">图表6：绩效指标</view>
    <view class="muted">累计收益：{{m.cumulative_return}}｜年化收益：{{m.annualized_return}}｜年化波动：{{m.annualized_volatility}}</view>
    <view class="muted">最大回撤：{{m.max_drawdown}}｜修复时长：{{m.max_drawdown_recovery_days}}天</view>
    <view class="muted">夏普：{{m.sharpe_ratio}}｜卡玛：{{m.calmar_ratio}}｜索诺提：{{m.sortino_ratio}}</view>
    <view class="muted">溃疡(UI)：{{m.ulcer_index}}｜UPI：{{m.ulcer_performance_index}}</view>
  </view>

  <view class="card">
    <view class="title">图表7：收益贡献（Return Contribution）</view>
    <canvas canvas-id="cRC" id="cRC" style="width: 100%; height: 220rpx;"></canvas>
  </view>

  <view class="card">
    <view class="title">图表8：风险贡献（Risk Share）</view>
    <canvas canvas-id="cRiskC" id="cRiskC" style="width: 100%; height: 220rpx;"></canvas>
  </view>

  <view class="card">
    <view class="title">图表9：相关性（Pearson）</view>
    <canvas canvas-id="cCorr" id="cCorr" style="width: 100%; height: 260rpx;"></canvas>
  </view>

  <view class="card">
    <view class="title">图表10：组合收益率日历（日/月/年）</view>
    <view class="row" style="margin-top: 10rpx; flex-wrap: wrap; justify-content:flex-start;">
      <button size="mini" bindtap="setCalMode" data-m="daily">日度</button>
      <button size="mini" bindtap="setCalMode" data-m="monthly">月度</button>
      <button size="mini" bindtap="setCalMode" data-m="yearly">年度</button>
      <view class="muted" style="margin-left: 10rpx;">当前：{{calModeLabel}}</view>
    </view>

    <!-- Daily calendar: one month -->
    <view wx:if="{{calMode==='daily'}}" style="margin-top: 12rpx;">
      <view class="row" style="justify-content:space-between;">
        <button size="mini" bindtap="prevCalMonth">上一月</button>
        <view class="muted">{{calDailyMonth}}</view>
        <button size="mini" bindtap="nextCalMonth">下一月</button>
      </view>
      <view class="cal-grid" style="margin-top: 10rpx;">
        <view class="cal-head">日</view>
        <view class="cal-head">一</view>
        <view class="cal-head">二</view>
        <view class="cal-head">三</view>
        <view class="cal-head">四</view>
        <view class="cal-head">五</view>
        <view class="cal-head">六</view>

        <block wx:for="{{calDailyCells}}" wx:key="k">
          <view class="cal-cell {{item.kind}}">
            <view class="cal-day">{{item.dayText}}</view>
            <view class="cal-ret">{{item.retText}}</view>
          </view>
        </block>
      </view>
      <view class="muted" style="margin-top: 8rpx;">
        说明：仅交易日显示收益；周日为一周第一天，周六为最后一天。
      </view>
    </view>

    <!-- Monthly calendar: each year 3x4 -->
    <view wx:if="{{calMode==='monthly'}}" style="margin-top: 12rpx;">
      <block wx:for="{{calMonthlyYears}}" wx:key="year">
        <view class="muted" style="margin-top: 10rpx;">{{item.year}}</view>
        <view class="mon-grid">
          <block wx:for="{{item.cells}}" wx:key="k">
            <view class="mon-cell {{item.kind}}">
              <view class="mon-title">{{item.title}}</view>
              <view class="mon-ret">{{item.retText}}</view>
            </view>
          </block>
        </view>
      </block>
    </view>

    <!-- Yearly calendar: 4 columns -->
    <view wx:if="{{calMode==='yearly'}}" style="margin-top: 12rpx;">
      <view class="yr-grid">
        <block wx:for="{{calYearlyCells}}" wx:key="year">
          <view class="yr-cell {{item.kind}}">
            <view class="yr-title">{{item.year}}</view>
            <view class="yr-ret">{{item.retText}}</view>
          </view>
        </block>
      </view>
    </view>
  </view>
</view>

